#include"mapdata.nvgt"
#include"m_pro.nvgt"
#include"form.nvgt"
#include"submenu_system.nvgt"
#include "helpmenu.nvgt"
dynamic_menu_pro m;
audio_form form;
sub_menu_system s;
void mainmenu(bool fromgame = false) {
	s.reset();
	if (fromgame == false) s.add_music(musictrack);
	s.open_sound = menuopen;
	s.enter_sound = menuenter;
	s.click_sound = menuclick;
	s.close_sound = menuclose;
	s.wrap_sound = menuwrap;
	s.edge_sound = menuedge;
	if (sidescrolling == 1) {
		s.enable_side_scrolling = true;
		s.enable_left_and_right = true;
	} else {
		s.enable_side_scrolling = false;
		s.enable_up_and_down = true;
	}
	if (buffermode == 1)
		s.pp = true;
	else if (buffermode == 0)
		s.pp = false;
	if (ssbuffermode == 1)
		s.sspp = true;
	else if (ssbuffermode == 0)
		s.sspp = false;
	if (wrap == 1)
		s.wrap = true;
	else
		s.wrap = false;
	if (letters_autoactivate == 1)
		s.letters_autoactivate = true;
	else
		s.letters_autoactivate = false;
	if (mouse == 1)
		s.enable_mouse = true;
	else
		s.enable_mouse = false;
	if (djoystick == 1)
		s.enable_joystick = true;
	else
		s.enable_joystick = false;
	if (fromgame)
		s.add_sub_menu("settings");
	else {
		if (rules == 1)
			s.add_sub_menu("account");
		s.add_sub_menu("speaker test");
		s.add_sub_menu("settings");
		s.add_sub_menu("misc");
	}
	s.add_sub_menu_item("account", "connect");
	s.add_sub_menu_item("account", "register");
	s.add_sub_menu_item("account", " character and account storage");
	s.add_sub_menu_item("speaker test", "by audio");
	s.add_sub_menu_item("speaker test", "by default");
	s.add_sub_menu_item("speaker test", "by text");
	if (importbufferlogs == 0)
		s.add_sub_menu_item("settings", "enable buffer logging");
	else
		s.add_sub_menu_item("settings", "disable buffer logging");
	//if(playlogo==0)
	//s.add_sub_menu_item("settings","enable playing logo at startup");
	//else if(playlogo==1)
	//s.add_sub_menu_item("settings","disable playing logo at startup");
	//if(checkcfu==0)
	//s.add_sub_menu_item("settings","enable checking for updates at startup");
	//else if(checkcfu==1)
	//s.add_sub_menu_item("settings","disable checking for updates at startup");
	//if(checkcmotd==0)
	//{
	//s.add_sub_menu_item("settings","enable checking for clientside message of the day at startup");
	//}
	//else if(checkcmotd==1)
	//{
	//s.add_sub_menu_item("settings","enable showing the new clientside message of the day "+(motdshow==1?"always":"just once")+" at startup");
	//s.add_sub_menu_item("settings","disable checking for clientside message of the day at startup");
	//}
	s.add_sub_menu_item("settings", "Add alias");
	s.add_sub_menu_item("settings", "Remove alias");
	s.add_sub_menu_item("settings", "Add script key");
	s.add_sub_menu_item("settings", "Remove script key");
	s.add_sub_menu_item("settings", "Select menu sounds");
	if (fromgame == false) s.add_sub_menu_item("settings", "Select menu music");
	s.add_sub_menu_item("settings", "set game volume");
	if (sidescrolling == 0) {
		s.add_sub_menu_item("settings", "change menu stile to side scrolling");
		if (buffermode == 0)
			s.add_sub_menu_item("settings", "enable buffer mode");
		else
			s.add_sub_menu_item("settings", "disable buffer mode");
	} else {
		s.add_sub_menu_item("settings", "change menu stile to default");
		if (ssbuffermode == 0)
			s.add_sub_menu_item("settings", "enable side scrolling buffer mode");
		else
			s.add_sub_menu_item("settings", "disable side scrolling buffer mode");
	}
	s.add_sub_menu_item("settings", "" + (bufferbeep == 1 ? "disable" : "enable") + " buffer beeping");
	if (wrap == 0)
		s.add_sub_menu_item("settings", "enable menu wrapping");
	else
		s.add_sub_menu_item("settings", "disable menu wrapping");
	s.add_sub_menu_item("settings", "" + (lcontrol == 1 ? "disable" : "enable") + " left control detection");
	s.add_sub_menu_item("settings", "" + (rcontrol == 1 ? "disable" : "enable") + " right control detection");
	s.add_sub_menu_item("settings", "" + (lshift == 1 ? "disable" : "enable") + " left shift detection");
	s.add_sub_menu_item("settings", "" + (rshift == 1 ? "disable" : "enable") + " right shift detection");
	s.add_sub_menu_item("settings", "" + (lalt == 1 ? "disable" : "enable") + " left alt detection");
	s.add_sub_menu_item("settings", "" + (ralt == 1 ? "disable" : "enable") + " right alt detection");
	if (asktoexit == 0)
		s.add_sub_menu_item("settings", "Enable ask to exit");
	else if (asktoexit == 1)
		s.add_sub_menu_item("settings", "Disable ask to exit");
	s.add_sub_menu_item("settings", "" + (winsound == 0 ? "disable" : "enable") + " muting audio when the game is not in focus");
	s.add_sub_menu_item("settings", "Select output device");
	if (j.joysticks > 1)
		s.add_sub_menu_item("settings", "Choose the default joystick/game pad");
	s.add_sub_menu_item("settings", "" + (autologin == 1 ? "disable" : "enable") + " auto login");
	s.add_sub_menu_item("settings", "" + (autolower == 1 ? "disable" : "enable") + " lower pitch when exiting from the game");
	s.add_sub_menu_item("settings", "" + (mouse == 1 ? "disable" : "enable") + " using mouse");
	s.add_sub_menu_item("settings", "" + (djoystick == 1 ? "disable" : "enable") + " using joystick");
	if (behind_pitch_decrease == 0)
		s.add_sub_menu_item("settings", "enable behind pitch decrease");
	else
		s.add_sub_menu_item("settings", "disable behind pitch decrease");
	if (askauction==0)
		s.add_sub_menu_item("settings","Enable auction agreement");
	else if (askauction==1)
		s.add_sub_menu_item("settings","Disable auction agreement");
	if (askbid==0)
		s.add_sub_menu_item("settings","Enable bid agreement in auctions");
	else if (askbid==1)
		s.add_sub_menu_item("settings","Disable bid agreement in auctions");
	if (braille_support == 0)
		s.add_sub_menu_item("settings", "enable braille support");
	else
		s.add_sub_menu_item("settings", "disable braille support");
	if (othershearyourpmsound == 0)
		s.add_sub_menu_item("settings", "enable other people hearing your pm sound");
	else
		s.add_sub_menu_item("settings", "disable other people hearing your pm sound");
	if (hearotherspmsound == 0)
		s.add_sub_menu_item("settings", "enable hearing other people's pm sound");
	else
		s.add_sub_menu_item("settings", "disable hearing other people's pm sound");
	s.add_sub_menu_item("settings", "change the tracking mode to " + (trackingmode == 1 ? "normal mode" : "secondary mode") + "");
	s.add_sub_menu_item("settings", "set chat sound");
	s.add_sub_menu_item("settings", "set local chat sound");
	s.add_sub_menu_item("settings", "set online sound");
	s.add_sub_menu_item("settings", "set offline sound");
	s.add_sub_menu_item("settings", "set pm sound");
	s.add_sub_menu_item("settings", "set jumping sound");
	if (fromgame) s.add_sub_menu_item("settings", "set online message");
	if (fromgame) s.add_sub_menu_item("settings", "set offline message");
	s.add_sub_menu_item("settings", "" + (chsound == 1 ? "disable" : "enable") + " pitch of chat sound");
	s.add_sub_menu_item("settings", "" + (lcsound == 1 ? "disable" : "enable") + " pitch of local chat sound");
	s.add_sub_menu_item("settings", "" + (onsound == 1 ? "disable" : "enable") + " pitch of online sound");
	s.add_sub_menu_item("settings", "" + (offsound == 1 ? "disable" : "enable") + " pitch of offline sound");
	s.add_sub_menu_item("settings", "" + (pmsgsound == 1 ? "disable" : "enable") + " pitch of pm sound");
	if (fromgame) s.add_sub_menu_item("settings", "toggle having cycle inventory");
	if (letters_autoactivate == 0)
		s.add_sub_menu_item("settings", "enable letters autoactivate in menus");
	else
		s.add_sub_menu_item("settings", "disable letters autoactivate in menus");
	s.add_sub_menu_item("settings", "" + (dreaming == 1 ? "disable" : "enable") + " dreaming");
	s.add_sub_menu_item("settings", "reset settings to factory defaults");
	if (fromgame) s.add_sub_menu_item("settings", "go back");
	s.add_sub_menu_item("misc","open website");
	s.add_sub_menu_item("misc","Check for updates");
	if (!SCRIPT_COMPILED) s.add_sub_menu_item("misc", "Alternate between main and local host");
	s.add_sub_menu_item("misc", "exit");
	s.ingame = fromgame;
	string result = s.run((fromgame ? "settings menu" : "Ultra world main menu"));
	if (result == "account:connect")
		login();
	else if (result == "account:register") {
		creating = true;
		create();
	} else if (result == "account: character and account storage")
		accountstoragemenu();
	else if (result == "speaker test:by audio") {
		s.fade_music(20);
		audiomusicmenu();
	} else if (result == "speaker test:by default") {
		s.fade_music(20);
		dlgmeu("testing speakers", "testspeakers.ogg", true, 25);
		mainmenu();
	} else if (result == "speaker test:by text") {
		s.fade_music(20);
		textmenu();
	} else if (result == "settings:reset settings to factory defaults") {
		int r = question("Confirmation", "Are you sure you want to reset you're settings?");
		if (r == 1) {
			file_delete("data.dat");
			dlg("all settings has been reset. Press enter to restart the client to reflect new changes");
			writeprefs();
			run("c:\\windows\\explorer.exe", "\"" + self_file() + "\"", false, false);
			if (autologin == 0 and importbufferlogs == 1) export_all_buffers();
			exit();
		} else {
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:" + (readerinterrupt == 1 ? "disable" : "enable") + " speech interrupt") {
		readerinterrupt = toggle(readerinterrupt);
		writeprefs();
		speak("Speech interrupt " + (readerinterrupt == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Select output device") {
		if (fromgame) soundcardmenu(true);
		else soundcardmenu();
	} else if (result == "settings:Add alias") {
		string text = v.input("enter a text");
		if (text != "" and !is_eloquence_crash_word(text) and get_sequence(text, true) <= 3) {
			string text2 = v.input("Enter the text replacement");
			if (text2 != "" and !is_eloquence_crash_word(text2) and get_sequence(text2, true) <= 3)
				aliases.insert_last("" + text + ":" + text2 + "");
		}
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Remove alias") {
		if (fromgame) removealiasmenu(true);
		else removealiasmenu();
	} else if (result == "settings:Add script key") {
		string number = v.input("press the key which the script key text refares to, from ` to =");
		if (number != "" and !is_eloquence_crash_word(number) and get_sequence(number, true) <= 3) {
			string text = v.input("Enter your text");
			if (text != "" and !is_eloquence_crash_word(text) and get_sequence(text, true) <= 3)
				script_keys.insert_last("" + number + ":" + text + "");
		}
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Remove script key") {
		if (fromgame) removescript_keymenu(true);
		else removescript_keymenu();
	} else if (result == "settings:Enable ask to exit") {
		asktoexit = 0;
		speak("ask to exit enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Disable ask to exit") {
		asktoexit = 1;
		speak("ask to exit disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Hold voice chat keys to speak") {
		holdv = 0;
		speak("now pressing voice chat keys to toggle speaking");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Press voice chat keys to toggle speaking") {
		holdv = 1;
		speak("now holding voice chat keys to talk");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Enable voice chat") {
		voicechat = 1;
		speak("voice chat enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Disable voice chat") {
		voicechat = 0;
		speak("voice chat disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (bufferbeep == 1 ? "disable" : "enable") + " buffer beeping") {
		bufferbeep = toggle(bufferbeep);
		writeprefs();
		speak("Buffer beeping " + (bufferbeep == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (dreaming == 1 ? "disable" : "enable") + " dreaming") {
		dreaming = toggle(dreaming);
		writeprefs();
		speak("dreaming " + (dreaming == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (winsound == 0 ? "disable" : "enable") + " muting audio when the game is not in focus") {
		winsound = toggle(winsound);
		writeprefs();
		speak("muting audio when the game is not in focus " + (winsound == 0 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:mute speech") {
		mutetts = 1;
		writeprefs();
		speak("speach muted");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:unmute speech") {
		mutetts = 0;
		writeprefs();
		speak("speach unmuted");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable behind pitch decrease") {
		behind_pitch_decrease = 1;
		writeprefs();
		speak("behind pitch decrease has been enabled");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable behind pitch decrease") {
		behind_pitch_decrease = 0;
		writeprefs();
		speak("behind pitch decrease has been disabled");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable stereo typing") {
		stereotyping = 1;
		writeprefs();
		speak("stereo typing has been enabled");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable stereo typing") {
		stereotyping = 0;
		writeprefs();
		speak("stereo typing has been disabled");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Enable auction agreement") {
		askauction = 1;
		speak("auction agreement enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Disable auction agreement") {
		askauction = 0;
		speak("auction agreement disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Enable bid agreement in auctions") {
		askbid = 1;
		speak("bid agreement enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Disable bid agreement in auctions") {
		askbid = 0;
		speak("bid agreement disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:select language") {
		string temp = langmenu();
		if (temp == "") {
			speak("No action will be taken");
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			currentlangfile = temp;
			lngdata = file_get_contents("languages\\" + currentlangfile + ".lng");
			speak("" + currentlangfile + " is now your language");
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:enable buffer logging") {
		importbufferlogs = 1;
		speak("buffer logging enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable buffer logging") {
		importbufferlogs = 0;
		speak("Buffer logging disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable voice chat saving") {
		savevoicechats = 1;
		speak("voice chat saving enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable voice chat saving") {
		savevoicechats = 0;
		speak("voice chat saving disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable tts chat saving") {
		savettschats = 1;
		speak("tts chat saving enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable tts chat saving") {
		savettschats = 0;
		speak("tts chat saving disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable braille support") {
		braille_support = 1;
		speak("braille support enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable braille support") {
		braille_support = 0;
		speak("braille support disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable hearing your voice when voice chatting") {
		hearyourvoicechat = 1;
		speak("you'll hear your voice when voice chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable hearing your voice when voice chatting") {
		hearyourvoicechat = 0;
		speak("you won't hear your voice when voice chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable hearing your tts when tts chatting") {
		hearyourttschat = 1;
		speak("you'll hear your tts when tts chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable hearing your tts when tts chatting") {
		hearyourttschat = 0;
		speak("you won't hear your tts when tts chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable hearing others voice when voice chatting") {
		hearothersvoicechat = 1;
		speak("you'll hear others voice when voice chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable hearing others voice when voice chatting") {
		hearothersvoicechat = 0;
		speak("you won't hear others voice when voice chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable hearing others tts when tts chatting") {
		hearothersttschat = 1;
		speak("you'll hear others tts when tts chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable hearing others tts when tts chatting") {
		hearothersttschat = 0;
		speak("you won't hear others tts when tts chatting from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable hearing other people's pm sound") {
		hearotherspmsound = 1;
		speak("you'll hear other people's pm sound from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable hearing other people's pm sound") {
		hearotherspmsound = 0;
		speak("you won't hear other people's pm sound from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable other people hearing your pm sound") {
		othershearyourpmsound = 1;
		speak("other people will now hear your pm sound from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable other people hearing your pm sound") {
		othershearyourpmsound = 0;
		speak("other people won't hear your pm sound from now on");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:change menu stile to side scrolling") {
		sidescrolling = 1;
		speak("menu stile has been changed to side scrolling");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:change menu stile to default") {
		sidescrolling = 0;
		speak("menu stile has been changed to default");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable buffer mode") {
		buffermode = 1;
		speak("enabled buffer mode");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable buffer mode") {
		buffermode = 0;
		speak("disabled buffer mode");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable side scrolling buffer mode") {
		ssbuffermode = 1;
		speak("enabled side scrolling buffer mode");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable side scrolling buffer mode") {
		ssbuffermode = 0;
		speak("disabled side scrolling buffer mode");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable menu wrapping") {
		wrap = 1;
		speak("menu wrapping has been enabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable menu wrapping") {
		wrap = 0;
		speak("menu wrapping has been disabled");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable first letter navigation in menus") {
		first_letter_navigation = 1;
		speak("first_letter_navigation has been enabled in all menus");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable first letter navigation in menus") {
		first_letter_navigation = 0;
		speak("first letter navigation has been disabled in all menus");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable multi letter navigation in menus") {
		multi_letter_navigation = 1;
		speak("multi letter navigation has been enabled in all menus");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable multi letter navigation in menus") {
		multi_letter_navigation = 0;
		speak("multi letter navigation has been disabled in all menus");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:enable letters autoactivate in menus") {
		letters_autoactivate = 1;
		speak("letters autoactivate has been enabled in all menus");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:disable letters autoactivate in menus") {
		letters_autoactivate = 0;
		speak("letters autoactivate has been disabled in all menus");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Select speech mode") {
		if (fromgame) speechmodemenu(true);
		else speechmodemenu();
	} else if (result == "settings:Select SAPI voice") {
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Select speech rate") {
		if (fromgame) speechratemenu(true);
		else speechratemenu();
	}
	//else if(result=="settings:enable playing logo at startup")
	//{
	//playlogo=1;
	//speak("playing logo at startup enabled");
	//writeprefs();
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	//}
	//else if(result=="settings:disable playing logo at startup")
	//{
	//playlogo=0;
	//speak("playing logo at startup disabled");
	//writeprefs();
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	//}
	//else if(result=="settings:enable checking for updates at startup")
	//{
	//checkcfu=1;
	//speak("checking for updates at startup enabled");
	//writeprefs();
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	//}
	//else if(result=="settings:disable checking for updates at startup")
	//{
	//checkcfu=0;
	//speak("checking for updates at startup disabled");
	//writeprefs();
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	//}
	//else if(result=="settings:enable checking for clientside message of the day at startup")
	//{
	//checkcmotd=1;
	//speak("checking for clientside message of the day at startup enabled");
	//writeprefs();
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	//}
	//else if(result=="settings:disable checking for clientside message of the day at startup")
	//{
	//checkcmotd=0;
	//speak("checking for clientside message of the day disabled");
	//writeprefs();
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	//}
	//else if(result=="settings:enable showing the new clientside message of the day "+(motdshow==1?"always":"just once")+" at startup")
	//{
	//motdshow=toggle(motdshow);
	//writeprefs();
	//speak("now showing the new clientside message of the day "+(motdshow==1?"just once":"always"));
	//if(fromgame) mainmenu(true);
	//else mainmenu();
	else if (result == "settings:Select menu music") {
		s.fade_music(20);
		musicmenu();
	} else if (result == "settings:Select menu sounds") {
		if (fromgame) menusounds(true);
		else menusounds();
	} else if (result == "settings:set game volume") {
		if (fromgame) volume_menu(true);
		else volume_menu();
	} else if (result == "settings:" + (lcontrol == 1 ? "disable" : "enable") + " left control detection") {
		lcontrol = (lcontrol == 0 ? 1 : 0);
		speak("left control detection has been " + (lcontrol == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (rcontrol == 1 ? "disable" : "enable") + " right control detection") {
		rcontrol = (rcontrol == 0 ? 1 : 0);
		speak("right control detection has been " + (rcontrol == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (lshift == 1 ? "disable" : "enable") + " left shift detection") {
		lshift = (lshift == 0 ? 1 : 0);
		speak("left shift detection has been " + (lshift == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (rshift == 1 ? "disable" : "enable") + " right shift detection") {
		rshift = (rshift == 0 ? 1 : 0);
		speak("right shift detection has been " + (rshift == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (lalt == 1 ? "disable" : "enable") + " left alt detection") {
		lalt = (lalt == 0 ? 1 : 0);
		speak("left alt detection has been " + (lalt == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (ralt == 1 ? "disable" : "enable") + " right alt detection") {
		ralt = (ralt == 0 ? 1 : 0);
		speak("right alt detection has been " + (ralt == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (autologin == 1 ? "disable" : "enable") + " auto login") {
		autologin = (autologin == 0 ? 1 : 0);
		speak("auto login has been " + (autologin == 0 ? "disabled" : "enabled"));
		writeprefs();
		dlg("press enter to restart the client to reflect new changes");
		run("c:\\windows\\explorer.exe", "\"" + self_file() + "\"", false, false);
		if (autologin == 0 and importbufferlogs == 1) export_all_buffers();
		exit();
	} else if (result == "settings:" + (autolower == 1 ? "disable" : "enable") + " lower pitch when exiting from the game") {
		autolower = (autolower == 0 ? 1 : 0);
		speak("lowering pitch when exiting from game has been " + (autolower == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (mouse == 1 ? "disable" : "enable") + " using mouse") {
		mouse = (mouse == 0 ? 1 : 0);
		speak("using mouse " + (mouse == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (djoystick == 1 ? "disable" : "enable") + " using joystick") {
		djoystick = (djoystick == 0 ? 1 : 0);
		speak("using joystick " + (djoystick == 0 ? "disabled" : "enabled"));
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:Choose the default joystick/game pad") {
		if (fromgame) defjoymenu(true);
		else defjoymenu();
	} else if (result == "settings:Select voice") {
		if (fromgame) voicemenu(true);
		else voicemenu();
	} else if (result == "settings:change the tracking mode to " + (trackingmode == 1 ? "normal mode" : "secondary mode") + "") {
		trackingmode = (trackingmode == 0 ? 1 : 0);
		speak("tracking mode has been changed to the " + (trackingmode == 0 ? "normal" : "secondary") + " mode");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:go back")
		return;
	else if (result == "settings:set chat sound") {
		string soundfile = list_chatsounds();
		if (soundfile == "") {
			speak("canceled");
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			chatsound = soundfile;
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set local chat sound") {
		string soundfile = list_localchatsounds();
		if (soundfile == "") {
			speak("canceled");
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			localchatsound = soundfile;
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set online sound") {
		string soundfile = list_onlinesounds();
		if (soundfile == "") {
			speak("canceled");
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			onlinesound = soundfile;
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set offline sound") {
		string soundfile = list_offlinesounds();
		if (soundfile == "") {
			speak("canceled");
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			offlinesound = soundfile;
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set pm sound") {
		string soundfile = list_pmsounds();
		if (soundfile == "") {
			speak("canceled");
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			pmsound = soundfile;
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set jumping sound") {
		string soundfile = list_jumpsounds();
		if (soundfile == "") {
			speak("canceled");
			if (fromgame) mainmenu(true);
			else mainmenu();
		} else {
			jumpsound = soundfile;
			writeprefs();
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set online message") {
		string onmsg = v.input("type your online message");
		if (onmsg != "" and !is_eloquence_crash_word(onmsg) and get_sequence(onmsg, true) <= 3) {
			send_reliable(peer_id, "/setonlinemsg " + onmsg, 1);
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:set offline message") {
		string offmsg = v.input("type your offline message");
		if (offmsg != "" and !is_eloquence_crash_word(offmsg) and get_sequence(offmsg, true) <= 3) {
			send_reliable(peer_id, "/setofflinemsg " + offmsg, 1);
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:" + (chsound == 1 ? "disable" : "enable") + " pitch of chat sound") {
		chsound = toggle(chsound);
		writeprefs();
		speak("pitch of chat sound " + (chsound == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (lcsound == 1 ? "disable" : "enable") + " pitch of local chat sound") {
		lcsound = toggle(lcsound);
		writeprefs();
		speak("pitch of local chat sound " + (lcsound == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (onsound == 1 ? "disable" : "enable") + " pitch of online sound") {
		onsound = toggle(onsound);
		writeprefs();
		speak("pitch of online sound " + (onsound == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (offsound == 1 ? "disable" : "enable") + " pitch of offline sound") {
		offsound = toggle(offsound);
		writeprefs();
		speak("pitch of offline sound " + (offsound == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:" + (pmsgsound == 1 ? "disable" : "enable") + " pitch of pm sound") {
		pmsgsound = toggle(pmsgsound);
		writeprefs();
		speak("pitch of pm sound " + (pmsgsound == 1 ? "enabled" : "disabled"));
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (result == "settings:toggle having cycle inventory") {
		if (connected)
			send_reliable(peer_id, "havecycleinventory", 0);
		else {
			speak("you are not connected to the game, please try again later");
			if (fromgame) mainmenu(true);
			else mainmenu();
		}
	} else if (result == "settings:Change the server to localhost" and !SCRIPT_COMPILED) {
		netaddress = "127.0.0.1";
		netport = 45532;
		speak("done");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
	else if(result=="misc:open website") {
		urlopen(app.website);
		mainmenu();
	}
	else if(result=="misc:Check for updates") {
		s.fade_music(20);
		if (check_updates() != 0) mainmenu();
	} else if (result == "misc:exit") {
		s.fade_music(10);
		writeprefs();
		if (autologin == 0 and importbufferlogs == 1) export_all_buffers();
		exit();
	} else if (result == "misc:Alternate between main and local host") {
		netaddress = (netaddress == "localhost" ? mainnetaddress : "localhost");
		speak("Set to " + (netaddress == "localhost" ? "local" : "main") + " host");
		mainmenu();
	} else {
		if (fromgame) return;
		else {
			s.fade_music(10);
			writeprefs();
			if (autologin == 0 and importbufferlogs == 1) export_all_buffers();
			wait(500);
			exit();
		}
	}
}
void setupmenu(custom_menu&out c, string clicksound = menuenter, string movesound = menuclick, string wrapsound = menuwrap, string opensound = menuopen, string edgesound = menuedge, dictionary@ args = null) {
	c.reset(true);
	c.clicksound = clicksound;
	c.movesound = movesound;
	c.wrapsound = wrapsound;
	c.opensound = opensound;
	c.edgesound = edgesound;
	if (args !is null) {
		string d_str;
		if (args.get("copy_done", d_str)) c.copy_done = d_str;
		if (args.get("copy_fail", d_str)) c.copy_fail = d_str;
		if (args.get("copy_no", d_str)) c.copy_no = d_str;
	}
}
class menuitem {
	string name, ref, info;
	menuitem(string name, string ref = "", string info = "") {
		this.name = name;
		this.ref = ref;
		this.info = info;
		if (this.ref == "") this.ref = this.name;
	}
}
string menu(string title, menuitem@[] items, bool say_dialog = true, string def = "", string clicksound = menuenter, string movesound = menuclick, string wrapsound = menuwrap, string opensound = menuopen, string edgesound = menuedge, dictionary@ args = null) {
	if (@items == null) return def;
	custom_menu c;
	setupmenu(c, clicksound, movesound, wrapsound, opensound, edgesound, @args);
	for (uint a = 0; a < items.length(); a++) {
		if (@items[a] == null) continue;
		c.add(items[a].name, items[a].ref);
		if (items[a].info != "") c.set_information(items[a].ref, items[a].info);
	}
	if (c.item_length < 1) return def;
	c.create(title, say_dialog);
	while(c.running) {
		c.monitor();
		if (connected) mainloop();
		string r = c.click;
		if(r != "") return r;
		wait(5);
	}
	return def;
}
string menu(string title, custom_menu@ item, bool say_dialog = true, string def = "", string clicksound = menuenter, string movesound = menuclick, string wrapsound = menuwrap, string opensound = menuopen, string edgesound = menuedge, dictionary@ args = null) {
	if (@item == null) return def;
	menuitem@[] cs(0);
	foreach (menu_item@ c: item.items) {
		if (@c == null) continue;
		cs.insert_last(menuitem(c.name, c.ref, c.information));
	}
	return menu(title, cs, say_dialog, def, clicksound, movesound, wrapsound, opensound, edgesound, args);
}
void setupmenu(bool main = false, bool audo = false, bool ingame = false) {
	m.reset(true);
	if (main == true)
		m.add_music(musictrack);
	m.open_sound = menuopen;
	m.enter_sound = menuenter;
	m.click_sound = menuclick;
	m.close_sound = menuclose;
	m.wrap_sound = menuwrap;
	if (audo == true)
		m.edge_sound = menuedge;
	if (sidescrolling == 1) {
		m.enable_side_scrolling = true;
		m.enable_left_and_right = true;
	} else {
		m.enable_side_scrolling = false;
		m.enable_up_and_down = true;
	}
	if (buffermode == 1)
		m.pp = true;
	else if (buffermode == 0)
		m.pp = false;
	if (ssbuffermode == 1)
		m.sspp = true;
	else if (ssbuffermode == 0)
		m.sspp = false;
	if (wrap == 1)
		m.wrap = true;
	else
		m.wrap = false;
	if (first_letter_navigation == 1)
		m.enable_first_letter_navigation = true;
	else
		m.enable_first_letter_navigation = false;
	if (multi_letter_navigation == 1)
		m.enable_multi_letter_navigation = true;
	else
		m.enable_multi_letter_navigation = false;
	if (letters_autoactivate == 1)
		m.letters_autoactivate = true;
	else
		m.letters_autoactivate = false;
	if (mouse == 1)
		m.enable_mouse = true;
	else
		m.enable_mouse = false;
	if (djoystick == 1)
		m.enable_joystick = true;
	else
		m.enable_joystick = false;
	m.enable_home_and_end = true;
	m.click_at_edge = false;
	m.repeat_items_at_edges = true;
	m.ingame = ingame;
}
void menusetupmenu(bool main = false, bool audo = false) {
	m.reset(true);
	if (main == true)
		m.add_music(musictrack);
	m.open_sound = menuopen;
	m.enter_sound = menuenter;
	m.click_sound = menuclick;
	m.close_sound = menuclose;
	m.wrap_sound = menuwrap;
	if (audo == true)
		m.edge_sound = menuedge;
	if (sidescrolling == 1) {
		m.enable_side_scrolling = true;
		m.enable_left_and_right = true;
	} else {
		m.enable_side_scrolling = false;
		m.enable_up_and_down = true;
	}
	if (buffermode == 1)
		m.pp = true;
	else if (buffermode == 0)
		m.pp = false;
	if (ssbuffermode == 1)
		m.sspp = true;
	else if (ssbuffermode == 0)
		m.sspp = false;
	if (wrap == 1)
		m.wrap = true;
	else
		m.wrap = false;
	if (first_letter_navigation == 1)
		m.enable_first_letter_navigation = true;
	else
		m.enable_first_letter_navigation = false;
	if (multi_letter_navigation == 1)
		m.enable_multi_letter_navigation = true;
	else
		m.enable_multi_letter_navigation = false;
	if (letters_autoactivate == 1)
		m.letters_autoactivate = true;
	else
		m.letters_autoactivate = false;
	if (mouse == 1)
		m.enable_mouse = true;
	else
		m.enable_mouse = false;
	if (djoystick == 1)
		m.enable_joystick = true;
	else
		m.enable_joystick = false;
	m.enable_tab = true;
	m.enable_space = true;
	m.enable_home_and_end = true;
	m.click_at_edge = false;
	m.repeat_items_at_edges = true;
}
void menusilent() {
	m.reset(true);
	m.open_sound = "a";
	m.enter_sound = "a";
	m.click_sound = "a";
	m.wrap_sound = "a";
	m.letters_autoactivate = true;
	m.edge_sound = "a";
	if (sidescrolling == 1) {
		m.enable_side_scrolling = true;
		m.enable_left_and_right = true;
	} else {
		m.enable_side_scrolling = false;
		m.enable_up_and_down = true;
	}
	if (buffermode == 1)
		m.pp = true;
	else if (buffermode == 0)
		m.pp = false;
	if (ssbuffermode == 1)
		m.sspp = true;
	else if (ssbuffermode == 0)
		m.sspp = false;
	if (wrap == 1)
		m.wrap = true;
	else
		m.wrap = false;
	if (first_letter_navigation == 1)
		m.enable_first_letter_navigation = true;
	else
		m.enable_first_letter_navigation = false;
	if (multi_letter_navigation == 1)
		m.enable_multi_letter_navigation = true;
	else
		m.enable_multi_letter_navigation = false;
	if (letters_autoactivate == 1)
		m.letters_autoactivate = true;
	else
		m.letters_autoactivate = false;
	if (mouse == 1)
		m.enable_mouse = true;
	else
		m.enable_mouse = false;
	if (djoystick == 1)
		m.enable_joystick = true;
	else
		m.enable_joystick = false;
	m.enable_home_and_end = true;
	m.click_at_edge = false;
	m.repeat_items_at_edges = true;
}
void accountstoragemenu() {
	setupmenu(false, true);
	m.add_item_tts("account list", "accountlist");
	m.add_item_tts("add a new account", "addaccount");
	m.add_item_tts("remove an existing account", "removeaccount");
	m.add_item_tts("go back", "back");
	int mres = m.run("select an option", true);
	if (m.get_item_name(mres) == "back" or mres == 0)
		mainmenu();
	else if (m.get_item_name(mres) == "accountlist")
		accountlistmenu();
	else if (m.get_item_name(mres) == "addaccount") {
		if (screen_reader_is_running(1))
			form.set_output_mode(JAWS);
		if (screen_reader_is_running(2))
			form.set_output_mode(WINDOW_EYES);
		if (screen_reader_is_running(3))
			form.set_output_mode(SYSTEM_ACCESS);
		if (screen_reader_is_running(4))
			form.set_output_mode(NVDA);
		form.create_window("new account", false);
		int user = form.create_input_box("&Username");
		int pass = form.create_input_box("&Password", "", "*");
		int ok = form.create_button("&Ok");
		int cancel = form.create_button("&Cancel");
		form.set_button_attributes(ok, true, false);
		form.set_button_attributes(cancel, false, true);
		while (true) {
			form.monitor();
			wait(5);
			if (form.is_pressed(cancel)) {
				form.reset();
				reset_network();
				accountstoragemenu();
			} else if (form.is_pressed(ok)) {
				if (form.get_text(user) == "" or string_contains(form.get_text(user), " ", 1) != -1) {
					dlg("An error has occured. Please check the username field and try again");
					form.reset();
					reset_network();
					accountstoragemenu();
				} else if (form.get_text(pass) == "" or string_contains(form.get_text(pass), " ", 1) != -1) {
					dlg("An error has occured. Please check the password field and try again");
					form.reset();
					reset_network();
					accountstoragemenu();
				} else {
					name = form.get_text(user);
					password = form.get_text(pass);
					accounts.insert_last("name: " + name + ". Password: " + password + "");
					writeprefs();
					form.reset();
					dlg("account has been added Successfully! Press enter to continue");
					accountstoragemenu();
				}
			}
		}
	} else if (m.get_item_name(mres) == "removeaccount")
		removeaccountmenu();
}
void accountlistmenu() {
	setupmenu(false, true);
	if (accounts.length() < 1) {
		speak("storage is empty");
		accountstoragemenu();
	} else {
		for (uint a = 0; a < accounts.length(); a += 1) {
			string a2 = string_replace(accounts[a], "name: ", "aew" + app.version + "", true);
			string a3 = string_replace(a2, ". Password: ", "aew" + app.version + "", true);
			string[] a4 = string_split(a3, "aew" + app.version + "", true);
			m.add_item_tts("" + a4[0] + ". Password: " + a4[1] + "", "" + a4[0] + "aew" + app.version + "" + a4[1] + "");
		}
	}
	m.add_item_tts("go back", "back");
	int mres = m.run("choose one of your already setted up accounts and press enter on them to be set", true);
	if (m.get_item_name(mres) == "back" or mres == 0)
		accountstoragemenu();
	else {
		string[] ass = string_split(m.get_item_name(mres), "aew" + app.version + "", true);
		name = ass[0];
		password = ass[1];
		writeprefs();
		dlg("Success!");
		mainmenu();
	}
}
void removeaccountmenu() {
	setupmenu(false, true);
	if (accounts.length() < 1) {
		speak("storage is empty");
		accountstoragemenu();
	} else {
		for (uint i = 0; i < accounts.length(); i++)
			m.add_item_tts(accounts[i], accounts[i]);
	}
	m.add_item_tts("go back", "back");
	int mres = m.run("Select the line that should be removed", true);
	if (m.get_item_name(mres) == "back" or mres == 0)
		accountstoragemenu();
	else {
		int something = accounts.find(m.get_item_name(mres));
		if (something > -1)
			accounts.remove_at(something);
		speak("done");
		accountstoragemenu();
	}
}
void voicemenu(bool fromgame = false) {
	menusetupmenu(false, true);
	m.add_item("v1name.ogg", "1");
	m.add_item("v2name.ogg", "2");
	m.add_item("v3name.ogg", "3");
	m.add_item("v4name.ogg", "4");
	m.add_item("v5name.ogg", "5");
	m.add_item("v6name.ogg", "6");
	m.add_item("v7name.ogg", "7");
	m.add_item("v8name.ogg", "8");
	m.add_item("v9name.ogg", "9");
	m.add_item("v10name.ogg", "10");
	m.add_item("v11name.ogg", "11");
	m.add_item("v12name.ogg", "12");
	m.add_item_tts("go back", "back");
	m.set_callback(vclb, "");
	int mres = m.run("select your voice. Press up and down, or if side scroling is enabled left and right, or tab and shift tab to move, enter and space to select a menu", true);
	if (m.get_item_name(mres) == "back" or mres == 0) {
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		speak("done");
		voice = string_to_number(m.get_item_name(mres));
		if (fromgame) send_reliable(peer_id, "setvoice " + voice, 0);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void speechratemenu(bool fromgame = false) {
	setupmenu(false);
	for (int i = -10; i < 10; i += 1)
		m.add_item_tts("" + i, "" + i);
	m.add_item_tts("back", "back");
	int mres = m.run("Select the speech rate you would like to use for sapi", true);
	if (m.get_item_name(mres) == "back" or mres == 0) {
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		int nr = string_to_number(m.get_item_name(mres));
		speak("set");
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void speechmodemenu(bool fromgame = false) {
	setupmenu(false, true);
	m.add_item_tts("auto", "a");
	m.add_item_tts("SAPI", "s");
	int mres = m.run("Speech mode menu", true);
	if (m.get_item_name(mres) == "a") {
		speechmode = 0;
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "s") {
		speechmode = 1;
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void audiomusicmenu() {
	dlg("Use the left and right arrows to check the position of the speakers manually. Press or hold up and down arrows to change the sound volume. Press or hold page up and page down to change it's pitch. Press or hold space to play/pause the track. Press or hold r to reset the position, volume and pitch. Press or hold q to seek backward. Press or hold e to seek forward. Press or hold w to go to the beginning of the track. Press escape or enter to stop the track and go back to the main menu. Press enter to continue");
	sound audiomusic;
	string[] ambs = string_split(musictypes, "\r\n", false);
	string temp = ambs[random(0, ambs.length() - 1)];
	audiomusic.load(temp + ".ogg");
	audiomusic.play_looped();
	int volumetime = 40;
	int minvolume = -100;
	int maxvolume = 300;
	int pitchtime = 40;
	int minpitch = -350;
	int maxpitch = 350;
	int pantime = 30;
	int minpan = -100;
	int maxpan = 100;
	timer pantimer, pitchtimer, volumetimer;
	while (true) {
		wait(5);
		if (key_down(KEY_LEFT) and pantimer.elapsed >= pantime) {
			pantimer.restart();
			if (audiomusic.pan > minpan)
				audiomusic.pan = audiomusic.pan - 1;
			if (audiomusic.pan == minpan)
				speak("left");
		}
		if (key_down(KEY_RIGHT) and pantimer.elapsed >= pantime) {
			pantimer.restart();
			if (audiomusic.pan < maxpan)
				audiomusic.pan = audiomusic.pan + 1;
			if (audiomusic.pan == maxpan)
				speak("right");
		}
		if (key_down(KEY_DOWN) and volumetimer.elapsed >= volumetime) {
			volumetimer.restart();
			if (audiomusic.volume > minvolume)
				audiomusic.volume = audiomusic.volume - 1;
		}
		if (key_down(KEY_UP) and volumetimer.elapsed >= volumetime) {
			volumetimer.restart();
			if (audiomusic.volume < maxvolume)
				audiomusic.volume = audiomusic.volume + 1;
		}
		if (key_down(KEY_NEXT) and pitchtimer.elapsed >= pitchtime) {
			pitchtimer.restart();
			if (audiomusic.pitch > minpitch)
				audiomusic.pitch = audiomusic.pitch - 1;
		}
		if (key_down(KEY_PRIOR) and pitchtimer.elapsed >= pitchtime) {
			pitchtimer.restart();
			if (audiomusic.pitch < maxpitch)
				audiomusic.pitch = audiomusic.pitch + 1;
		}
		if (key_pressed(KEY_Q) == false and kq.pressing())
			audiomusic.seek(audiomusic.position - 1000);
		if (key_pressed(KEY_W) == false and kw.pressing())
			audiomusic.seek(0);
		if (key_pressed(KEY_E) == false and ke.pressing())
			audiomusic.seek(audiomusic.position + 1000);
		if (key_pressed(KEY_R) == false and kr.pressing()) {
			audiomusic.pan = 0;
			audiomusic.volume = 0;
			audiomusic.pitch = 100;
			speak("done");
		}
		if (key_pressed(KEY_SPACE) == false and kspace.pressing()) {
			if (audiomusic.playing == true)
				audiomusic.pause();
			else
				audiomusic.play();
		}
		if (key_pressed(KEY_ESCAPE) or key_pressed(KEY_RETURN)) {
			audiomusic.stop();
			mainmenu();
			break;
		}
	}
}
void textmenu() {
	sound s;
	dlg("Press left arrow to check your left speaker, space to check center, and right arrow to check your right speaker. Press escape or enter to go back to the main menu. Press enter to continue");
	while (true) {
		if (key_pressed(KEY_ESCAPE) or key_pressed(KEY_RETURN)) {
			mainmenu();
			break;
		}
		if (key_pressed(KEY_LEFT)) {
			string msg = tts.speak_to_memory("Left.");
			if (s.active) s.close();
			s.load(msg, msg.length(), true);
			s.pan = -100;
			s.play();
		}
		if (key_pressed(KEY_SPACE)) {
			string msg = tts.speak_to_memory("Center.");
			if (s.active) s.close();
			s.load(msg, msg.length(), true);
			s.play();
		}
		if (key_pressed(KEY_RIGHT)) {
			string msg = tts.speak_to_memory("Right.");
			if (s.active) s.close();
			s.load(msg, msg.length(), true);
			s.pan = 100;
			s.play();
		}
		wait(5);
	}
	s.close();
}
void volume_menu(bool fromgame = false) {
	setupmenu(false, true);
	m.add_item_tts("100%", "0");
	m.add_item_tts("90%", "90");
	m.add_item_tts("80%", "80");
	m.add_item_tts("70%", "70");
	m.add_item_tts("60%", "60");
	m.add_item_tts("50%", "50");
	m.add_item_tts("40%", "40");
	m.add_item_tts("30%", "30");
	m.add_item_tts("20%", "20");
	m.add_item_tts("10%", "10");
	m.add_item_tts("Go back", "back");
	int mres = m.run("select your volume.", true);
	if (m.get_item_name(mres) == "0") {
		set_sound_master_volume(0);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "90") {
		set_sound_master_volume(-10);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "80") {
		set_sound_master_volume(-20);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "70") {
		set_sound_master_volume(-30);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "60") {
		set_sound_master_volume(-40);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "50") {
		set_sound_master_volume(-50);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "40") {
		set_sound_master_volume(-60);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "30") {
		set_sound_master_volume(-70);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "20") {
		set_sound_master_volume(-80);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "10") {
		set_sound_master_volume(-90);
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "back" or mres == 0) {
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void exitmenu() {
	if (asktoexit == 1) {
		int mres = ask("Are you sure you want to exit?");
		if (mres == 1)
			exitgame();
	} else
		exitgame();
}
int yesno(string question) {
	int r = ask(question);
	return r;
}
void musicmenu() {
	setupmenu(false, true);
	string[] ambs = string_split(musictypes, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("Select a music track to be played in the main menu", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string newtrack = m.get_item_name(mres) + ".ogg";
		speak("done");
		musictrack = newtrack;
		writeprefs();
	}
	mainmenu();
}
void menusounds(bool fromgame = false) {
	setupmenu(false, true);
	m.add_item_tts("menu click sound", "menuclick");
	m.add_item_tts("menu close sound", "menuclose");
	m.add_item_tts("menu edge sound", "menuedge");
	m.add_item_tts("menu enter sound", "menuenter");
	m.add_item_tts("menu open sound", "menuopen");
	m.add_item_tts("menu wrap sound", "menuwrap");
	m.add_item_tts("Go back", "exit");
	int mres = m.run("select menu sound", true);
	if (m.get_item_name(mres) == "menuclick") {
		if (fromgame) menuclickm(true);
		else menuclickm();
	} else if (m.get_item_name(mres) == "menuclose") {
		if (fromgame) menuclosem(true);
		else menuclosem();
	} else if (m.get_item_name(mres) == "menuedge") {
		if (fromgame) menuedgem(true);
		else menuedgem();
	} else if (m.get_item_name(mres) == "menuenter") {
		if (fromgame) menuenterm(true);
		else menuenterm();
	} else if (m.get_item_name(mres) == "menuopen") {
		if (fromgame) menuopenm(true);
		else menuopenm();
	} else if (m.get_item_name(mres) == "menuwrap") {
		if (fromgame) menuwrapm();
		else menuwrapm();
	} else {
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void menuclickm(bool fromgame = false) {
	menusilent();
	string[] ambs = string_split(menuclicks, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("select menu click sound", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string menusound = m.get_item_name(mres) + ".ogg";
		speak("done");
		menuclick = menusound;
		writeprefs();
	}
	if (fromgame) menusounds(true);
	else menusounds();
}
void menuclosem(bool fromgame = false) {
	menusilent();
	string[] ambs = string_split(menucloses, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("select menu close sound", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string menusound = m.get_item_name(mres) + ".ogg";
		speak("done");
		menuclose = menusound;
		writeprefs();
	}
	if (fromgame) menusounds(true);
	else menusounds();
}
void menuedgem(bool fromgame = false) {
	menusilent();
	string[] ambs = string_split(menuedges, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("select menu edge sound", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string menusound = m.get_item_name(mres) + ".ogg";
		speak("done");
		menuedge = menusound;
		writeprefs();
	}
	if (fromgame) menusounds(true);
	else menusounds();
}
void menuenterm(bool fromgame = false) {
	menusilent();
	string[] ambs = string_split(menuenters, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("select menu enter sound", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string menusound = m.get_item_name(mres) + ".ogg";
		speak("done");
		menuenter = menusound;
		writeprefs();
	}
	if (fromgame) menusounds(true);
	else menusounds();
}
void menuopenm(bool fromgame = false) {
	menusilent();
	string[] ambs = string_split(menuopens, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("select menu open sound", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string menusound = m.get_item_name(mres) + ".ogg";
		speak("done");
		menuopen = menusound;
		writeprefs();
	}
	if (fromgame) menusounds(true);
	else menusounds();
}
void menuwrapm(bool fromgame = false) {
	menusilent();
	string[] ambs = string_split(menuwraps, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("go back", "back");
	int mres = m.run("select menu wrap sound", true);
	if (m.get_item_name(mres) != "back" and mres != 0) {
		string menusound = m.get_item_name(mres) + ".ogg";
		speak("done");
		menuwrap = menusound;
		writeprefs();
	}
	if (fromgame) menusounds(true);
	else menusounds();
}
void serverside_menu(string sndtxt, string menu, string menuitems) {
	string[] items = string_split(menuitems, "[]", false);
	if (items.length() < 1) return;
	menuitem@[] cs(0);
	if (menuitems == "" or menuitems == 0)
		return;
	for (uint i = 0; i < items.length(); i++) {
		string[] parsed = string_split(items[i], ":", false);
		cs.insert_last(menuitem(parsed[0], parsed[1]));
	}
	cs.insert_last(menuitem("go back", "back"));
	string mres = ::menu(menu, cs);
	if (mres == "back" or mres == "")
		send_reliable(peer_id, sndtxt + " back", 0);
	else
		send_reliable(peer_id, sndtxt + " " + mres, 0);
}
void serverside_menu2(string sndtxt, string menu, string menuitems) {
	string[] items = string_split(menuitems, "[]");
	if (items.length() < 1) return;
	menuitem@[] cs(0);
	if (menuitems == "" or menuitems == 0)
		return;
	for (uint i = 0; i < items.length(); i++) {
		string[] parsed = string_split(items[i], "|");
		if (parsed.length() < 2) continue;
		cs.insert_last(menuitem(parsed[0], parsed[1]));
	}
	cs.insert_last(menuitem("go back", "back"));
	string mres = ::menu(menu, cs);
	if (mres == "back" or mres == "")
		send_reliable(peer_id, sndtxt + " back", 0);
	else
		send_reliable(peer_id, sndtxt + " " + mres, 0);
}
void servermenu(string title, string items, bool interactable = false, int menuchan = 1, string actions = "") {
	menuitem@[] cs(0);
	items.replace_this("\r\n", "\n");
	if (interactable == true) {
		string[] itm = string_split(items, "\n");
		if (itm.length() < 1) return;
		string[] actm = string_split(actions, "-_", true);
		for (uint i = 0; i < itm.length(); i++) {
			cs.insert_last(menuitem(itm[i], itm[i]));
		}
		cs.insert_last(menuitem("go back", "back"));
		string mres = menu(title, cs);
		for (uint i = 0; i < itm.length(); i++) {
			if (mres == itm[i]) {
				int acitem = actm.find(itm[i]);
				if (acitem > -1) send_reliable(peer_id, actm[acitem], menuchan);
			}
		}
	} else {
		string[] itm = string_split(items, "\n");
		if (itm.length() < 1) return;
		for (uint i = 0; i < itm.length(); i++)
			cs.insert_last(menuitem(itm[i], itm[i]));
		string mres = menu(title, cs);
	}
}
void store_menu(string storeitems) {
	m.reset(true);
	m.ingame = connected;
	m.enter_sound = menuenter;
	m.click_sound = menuclick;
	m.edge_sound = menuedge;
	m.enable_first_letter_navigation = true;
	m.enable_up_and_down = true;
	if (wrap == 1)
		m.wrap = true;
	else
		m.wrap = false;
	if (first_letter_navigation == 1)
		m.enable_first_letter_navigation = true;
	else
		m.enable_first_letter_navigation = false;
	if (multi_letter_navigation == 1)
		m.enable_multi_letter_navigation = true;
	else
		m.enable_multi_letter_navigation = false;
	if (letters_autoactivate == 1)
		m.letters_autoactivate = true;
	else
		m.letters_autoactivate = false;
	if (mouse == 1)
		m.enable_mouse = true;
	else
		m.enable_mouse = false;
	if (djoystick == 1)
		m.enable_joystick = true;
	else
		m.enable_joystick = false;
	m.enable_home_and_end = true;
	m.set_callback(netclb, "");
	string[] items = string_split(storeitems, "\r\n", true);
	for (double i = 0; i < items.length(); i++) {
		string[] item = string_split(items[i], " ", true);
		string it = string_replace(item[0], ".", "", true);
		m.add_item_tts(items[i], it);
	}
	int mres = m.run("store menu. There are " + items.length() + " items.", true);
	if (mres != 0) {
		string amount = v.input("Amount of " + m.get_item_name(mres) + "?");
		send_reliable(peer_id, "purchase " + m.get_item_name(mres) + " " + amount, 0);
	}
}
string plattypemenu() {
	string plattype;
	setupmenu(false, true);
	m.speak_position_information = true;
	addplattypes();
	m.set_callback(plm, "");
	int mres = m.run("select platform type.", true);
	if (mres == 0)
		return"";
	else {
		plattype = m.get_item_name(mres);
		return plattype;
	}
}
string list_msocials() {
	string[] ambs = string_split(msocialtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.set_callback(netclb, "");
	int mres = m.run("Select social", true);
	if (mres == 0)
		return "";
	else
		return m.get_item_name(mres);
}
string list_fsocials() {
	string[] ambs = string_split(fsocialtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.set_callback(netclb, "");
	int mres = m.run("Select social", true);
	if (mres == 0)
		return "";
	else
		return m.get_item_name(mres);
}
string list_chatsounds() {
	string[] ambs = string_split(chatsoundtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("random", "random");
	m.add_item_tts("silence", "silence");
	m.set_callback(netclb, "");
	int mres = m.run("Select chat sound", true);
	if (mres == 0 or mres == "silence")
		return "";
	else if (mres == "random")
		return "random";
	else
		return m.get_item_name(mres);
}
string list_onlinesounds() {
	string[] ambs = string_split(onlinesoundtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("random", "random");
	m.add_item_tts("silence", "silence");
	m.set_callback(netclb, "");
	int mres = m.run("Select online sound", true);
	if (mres == 0 or mres == "silence")
		return "";
	else if (mres == "random")
		return "random";
	else
		return m.get_item_name(mres);
}
string list_offlinesounds() {
	string[] ambs = string_split(offlinesoundtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("random", "random");
	m.add_item_tts("silence", "silence");
	m.set_callback(netclb, "");
	int mres = m.run("Select offline sound", true);
	if (mres == 0 or mres == "silence")
		return "";
	else if (mres == "random")
		return "random";
	else
		return m.get_item_name(mres);
}
string list_pmsounds() {
	string[] ambs = string_split(pmsoundtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("random", "random");
	m.add_item_tts("silence", "silence");
	m.set_callback(netclb, "");
	int mres = m.run("Select pm sound", true);
	if (mres == 0 or mres == "silence")
		return "";
	else if (mres == "random")
		return "random";
	else
		return m.get_item_name(mres);
}
string list_localchatsounds() {
	string[] ambs = string_split(localchatsoundtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("random", "random");
	m.add_item_tts("silence", "silence");
	m.set_callback(netclb, "");
	int mres = m.run("Select local chat sound", true);
	if (mres == 0 or mres == "silence")
		return "";
	else if (mres == "random")
		return "random";
	else
		return m.get_item_name(mres);
}
string list_jumpsounds() {
	string[] ambs = string_split(jumpsoundtypes, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item(ambs[i] + ".ogg", ambs[i], ambs[i], true);
	m.add_item_tts("random", "random");
	m.add_item_tts("silence", "silence");
	m.set_callback(netclb, "");
	int mres = m.run("Select jump sound", true);
	if (mres == 0 or mres == "silence")
		return "";
	else if (mres == "random")
		return "random";
	else
		return m.get_item_name(mres);
}
string list_allsounds() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addallsoundtypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  a sound", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
string list_drawsounds() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	adddrawsounds();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  draw sound", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else {
		string toreturn = string_trim_left(m.get_item_name(mres), 4);
		return toreturn;
	}
}
string list_ambiences() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addsrctypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  sound source.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
string list_musics() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addmusictypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  music.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
string list_forcefieldsounds() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addforcefieldtypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  forcefield sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
string list_forcefieldhitsounds() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addforcefieldhitsoundtypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  forcefield sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void teamstore(string storeitems) {
	setupmenu();
	string[] items = string_split(storeitems, "\r\n", true);
	for (uint i = 0; i < items.length(); i++) {
		string[] item = string_split(items[i], " ", true);
		string it = string_replace(item[0], ",", "", true);
		m.add_item_tts(items[i], it);
	}
	int mres = m.run("team store. There are " + items.length() + " items.", true);
	if (mres != 0) {
		string amount = v.input("how many?");
		send_reliable(peer_id, "/teambuy " + amount + " " + m.get_item_name(mres), 1);
	}
}
void addallsoundtypes() {
	string[] ambs = string_split(allsounds, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
void adddrawsounds() {
	string[] ambs = string_split(drawsounds, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
void addsrctypes() {
	string[] ambs = string_split(srctypes, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
void addmusictypes() {
	string[] muss = string_split(musictypes, "\r\n", false);
	for (uint i = 0; i < muss.length(); i++)
		m.add_item_tts(muss[i], muss[i]);
}
void addforcefieldtypes() {
	string[] ambs = string_split(forcefieldsounds, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
void addforcefieldhitsoundtypes() {
	string[] ambs = string_split(forcefieldhitsounds, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_nrainsounds() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addnrainsoundtypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  raining sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addnrainsoundtypes() {
	string[] ambs = string_split(nrainsoundtypes, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_nonesounds() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addnonesoundtypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  noneing sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addnonesoundtypes() {
	string[] ambs = string_split(nonesoundtypes, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_signs() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addsigntypes();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  sign sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addsigntypes() {
	string[] ambs = string_split(signtypes, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_ds1s() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addds1s();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  looping sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addds1s() {
	string[] ambs = string_split(ds1types, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_ds2s() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addds2s();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  moving sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addds2s() {
	string[] ambs = string_split(ds2types, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_ds3s() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addds3s();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  opening sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addds3s() {
	string[] ambs = string_split(ds3types, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
string list_ds4s() {
	string ambs;
	setupmenu(false, true);
	m.speak_position_information = true;
	addds4s();
	m.add_item_tts("enter sound manually", "entersoundmanually");
	m.set_callback(srcclb, "");
	int mres = m.run("select  close sound.", true);
	if (mres == 0)
		return"";
	else if (m.get_item_name(mres) == "entersoundmanually") {
		string soundfile = v.input("enter soundname");
		if (soundfile == "") {
			speak("canceled");
			return "";
		} else
			return soundfile;
	} else
		return m.get_item_name(mres);
}
void addds4s() {
	string[] ambs = string_split(ds4types, "\r\n", false);
	for (uint i = 0; i < ambs.length(); i++)
		m.add_item_tts(ambs[i], ambs[i]);
}
int srcclb(dynamic_menu_pro@ test, string data) {
	if (key_pressed(KEY_SPACE)) {
		srcs.pause();
		srcs.load(m.get_item_name(m.menu_position) + ".ogg");
		srcs.play_looped();
	}
	if (key_down(KEY_LMENU) and key_pressed(KEY_F1))
		srcs.stop();
	if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT)) {
		if (key_pressed(KEY_COMMA) == false and kcomma.pressing())
			prevbufferitem();
		if (key_pressed(KEY_PERIOD) == false and kperiod.pressing())
			nextbufferitem();
		if (key_pressed(KEY_LBRACKET) == false and klbracket.pressing())
			bufferleft();
		if (key_pressed(KEY_RBRACKET) == false and krbracket.pressing())
			bufferright();
	}
	if (shift_is_down()) {
		if (key_pressed(KEY_COMMA))
			topbufferitem();
		if (key_pressed(KEY_PERIOD))
			bottombufferitem();
		if (key_pressed(KEY_LBRACKET))
			firstbuffer();
		if (key_pressed(KEY_RBRACKET))
			lastbuffer();
	}
	if (key_pressed(KEY_SLASH)) {
		string chat = v.input("type your message here");
		if (chat != "" and !is_eloquence_crash_word(chat) and get_sequence(chat, true) <= 3) {
			string[] chats = string_split(chat, "::", true);
			if (chat != "") {
				string sendmsg = chat;
				for (uint a = 0; a < aliases.length(); a += 1) {
					string[] a2 = string_split(aliases[a], ":", false);
					if (a2.length() == 2)
						sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
				}
				send_reliable(peer_id, sendmsg, 1);
			}
		}
	}
	if (key_pressed(KEY_BACKSLASH) and dlocalchat == 0) {
		string s = v.input("type your message here");
		if (s != "" and !is_eloquence_crash_word(s) and get_sequence(s, true) <= 3) {
			string sendmsg = s;
			for (uint a = 0; a < aliases.length(); a += 1) {
				string[] a2 = string_split(aliases[a], ":", false);
				if (a2.length() == 2)
					sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
			}
			send_reliable(peer_id, "localchat " + sendmsg, 0);
		}
	}
	if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT) and key_up(KEY_LMENU) and key_up(KEY_RMENU) and key_pressed(KEY_EQUALS)) {
		string colocar = v.input("enter the command. Note: / will be put before it automaticly");
		if (colocar != "" and !is_eloquence_crash_word(colocar) and get_sequence(colocar, true) <= 3) {
			string sendmsg = colocar;
			for (uint a = 0; a < aliases.length(); a += 1) {
				string[] a2 = string_split(aliases[a], ":", false);
				if (a2.length() == 2)
					sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
			}
			send_reliable(peer_id, "/" + sendmsg, 1);
		}
	}
	mainloop();
	return 0;
}
void addplattypes() {
	string[] platforms = string_split(tiletypes, "\r\n", false);
	for (uint i = 0; i < platforms.length(); i++)
		m.add_item_tts(platforms[i], platforms[i]);
}
int plm(dynamic_menu_pro@ test, string data) {
	if (key_down(KEY_SPACE) and walktimer.elapsed >= walktime) {
		walktimer.restart();
		if (string_left(m.get_item_name(m.menu_position), 4) == "wall") p.play_stationary(m.get_item_name(m.menu_position) + ".ogg", false);
		else p.play_stationary(m.get_item_name(m.menu_position) + "step" + random(1, 5) + ".ogg", false);
	}
	if (key_pressed(KEY_L) and shift_is_down())
		p.play_stationary(m.get_item_name(m.menu_position) + "land.ogg", false);
	if (key_pressed(KEY_S) and shift_is_down())
		p.play_stationary(m.get_item_name(m.menu_position) + "scuff.ogg", false);
	if (key_pressed(KEY_F) and shift_is_down())
		p.play_stationary(m.get_item_name(m.menu_position) + "fall.ogg", false);
	if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT)) {
		if (key_pressed(KEY_COMMA) == false and kcomma.pressing())
			prevbufferitem();
		if (key_pressed(KEY_PERIOD) == false and kperiod.pressing())
			nextbufferitem();
		if (key_pressed(KEY_LBRACKET) == false and klbracket.pressing())
			bufferleft();
		if (key_pressed(KEY_RBRACKET) == false and krbracket.pressing())
			bufferright();
	}
	if (shift_is_down()) {
		if (key_pressed(KEY_COMMA))
			topbufferitem();
		if (key_pressed(KEY_PERIOD))
			bottombufferitem();
		if (key_pressed(KEY_LBRACKET))
			firstbuffer();
		if (key_pressed(KEY_RBRACKET))
			lastbuffer();
	}
	if (key_pressed(KEY_SLASH)) {
		string chat = v.input("type your message here");
		if (chat != "" and !is_eloquence_crash_word(chat) and get_sequence(chat, true) <= 3) {
			string[] chats = string_split(chat, "::", true);
			if (chat != "") {
				string sendmsg = chat;
				for (uint a = 0; a < aliases.length(); a += 1) {
					string[] a2 = string_split(aliases[a], ":", false);
					if (a2.length() == 2)
						sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
				}
				send_reliable(peer_id, sendmsg, 1);
			}
		}
	}
	if (key_pressed(KEY_BACKSLASH) and dlocalchat == 0) {
		string s = v.input("type your message here");
		if (s != "" and !is_eloquence_crash_word(s) and get_sequence(s, true) <= 3) {
			string sendmsg = s;
			for (uint a = 0; a < aliases.length(); a += 1) {
				string[] a2 = string_split(aliases[a], ":", false);
				if (a2.length() == 2)
					sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
			}
			send_reliable(peer_id, "localchat " + sendmsg, 0);
		}
	}
	if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT) and key_up(KEY_LMENU) and key_up(KEY_RMENU) and key_pressed(KEY_EQUALS)) {
		string colocar = v.input("enter the command. Note: / will be put before it automaticly");
		if (colocar != "" and !is_eloquence_crash_word(colocar) and get_sequence(colocar, true) <= 3) {
			string sendmsg = colocar;
			for (uint a = 0; a < aliases.length(); a += 1) {
				string[] a2 = string_split(aliases[a], ":", false);
				if (a2.length() == 2)
					sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
			}
			send_reliable(peer_id, "/" + sendmsg, 1);
		}
	}
	mainloop();
	return 0;
}
int vclb(dynamic_menu_pro@ test, string data) {
	if (key_pressed(KEY_N) and shift_is_down())
		p.play_stationary("v" + m.get_item_name(m.menu_position) + "name.ogg", false);
	if (key_pressed(KEY_D) and shift_is_down())
		p.play_stationary("v" + m.get_item_name(m.menu_position) + "die.ogg", false);
	if (key_pressed(KEY_H) and shift_is_down())
		p.play_stationary("v" + m.get_item_name(m.menu_position) + "hit" + random(1, 5) + ".ogg", false);
	if (connected) {
		if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT)) {
			if (key_pressed(KEY_COMMA) == false and kcomma.pressing())
				prevbufferitem();
			if (key_pressed(KEY_PERIOD) == false and kperiod.pressing())
				nextbufferitem();
			if (key_pressed(KEY_LBRACKET) == false and klbracket.pressing())
				bufferleft();
			if (key_pressed(KEY_RBRACKET) == false and krbracket.pressing())
				bufferright();
		}
		if (shift_is_down()) {
			if (key_pressed(KEY_COMMA))
				topbufferitem();
			if (key_pressed(KEY_PERIOD))
				bottombufferitem();
			if (key_pressed(KEY_LBRACKET))
				firstbuffer();
			if (key_pressed(KEY_RBRACKET))
				lastbuffer();
		}
		if (key_pressed(KEY_SLASH)) {
			string chat = v.input("type your message here");
			if (chat != "" and !is_eloquence_crash_word(chat) and get_sequence(chat, true) <= 3) {
				string[] chats = string_split(chat, "::", true);
				if (chat != "") {
					string sendmsg = chat;
					for (uint a = 0; a < aliases.length(); a += 1) {
						string[] a2 = string_split(aliases[a], ":", false);
						if (a2.length() == 2)
							sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
					}
					send_reliable(peer_id, sendmsg, 1);
				}
			}
		}
		if (key_pressed(KEY_BACKSLASH) and dlocalchat == 0) {
			string s = v.input("type your message here");
			if (s != "" and !is_eloquence_crash_word(s) and get_sequence(s, true) <= 3) {
				string sendmsg = s;
				for (uint a = 0; a < aliases.length(); a += 1) {
					string[] a2 = string_split(aliases[a], ":", false);
					if (a2.length() == 2)
						sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
				}
				send_reliable(peer_id, "localchat " + sendmsg, 0);
			}
		}
		if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT) and key_up(KEY_LMENU) and key_up(KEY_RMENU) and key_pressed(KEY_EQUALS)) {
			string colocar = v.input("enter the command. Note: / will be put before it automaticly");
			if (colocar != "" and !is_eloquence_crash_word(colocar) and get_sequence(colocar, true) <= 3) {
				string sendmsg = colocar;
				for (uint a = 0; a < aliases.length(); a += 1) {
					string[] a2 = string_split(aliases[a], ":", false);
					if (a2.length() == 2)
						sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
				}
				send_reliable(peer_id, "/" + sendmsg, 1);
			}
		}
	}
	mainloop();
	return 0;
}
int netclb(dynamic_menu_pro@ m, string data) {
	mainloop();
	return 0;
}
string langmenu() {
	if (!directory_exists("languages")) {
		dlg("Could not find languages");
		return "";
	}
	string[] lngfiles = find_files("languages/*.lng");
	if (lngfiles.length() <= 0) {
		dlg("No languages found");
		return "";
	}
	setupmenu(false, true);
	m.speak_position_information = true;
	for (uint i = 0; i < lngfiles.length(); i++)
		m.add_item_tts(string_replace(lngfiles[i], ".lng", "", true), lngfiles[i]);
	int mres = m.run("Select your language", true);
	if (mres <= 0)
		return "";
	else return string_trim_right(m.get_item_name(mres), 4);
}
string keyboardlangmenu() {
	if (!directory_exists("keyboard_languages")) {
		dlg("Could not find keyboard languages");
		return "";
	}
	string[] lngfiles = find_files("keyboard_languages/*.lng");
	if (lngfiles.length() <= 0) {
		dlg("No keyboard languages found");
		return "";
	}
	setupmenu(false, true);
	m.speak_position_information = true;
	for (uint i = 0; i < lngfiles.length(); i++)
		m.add_item_tts(string_replace(lngfiles[i], ".lng", "", true), lngfiles[i]);
	int mres = m.run("Select your keyboard language", true);
	if (mres <= 0)
		return "";
	else return string_trim_right(m.get_item_name(mres), 4);
}
void convertermenu() {
	setupmenu(false, true);
	m.add_item_tts("coins to dollar", "coinsparadollar");
	m.add_item_tts("Dollar to coins", "dollarparacoins");
	m.add_item_tts("Dlpoint to dollar", "dlpointparadollar");
	m.add_item_tts("Go back", "back");
	m.set_callback(netclb, "");
	int mres = m.run("What you'd like to converte?", true);
	if (m.get_item_name(mres) == "back")
		return;
	else if (m.get_item_name(mres) == "coinsparadollar") {
		string colocar = v.input("how meny you'd like to be converted?");
		if (colocar != "" and !is_eloquence_crash_word(colocar) and get_sequence(colocar, true) <= 3) send_reliable(peer_id, "coinsparadollar " + colocar, 0);
	} else if (m.get_item_name(mres) == "dollarparacoins") {
		string colocar = v.input("how meny you'd like to be converted?");
		if (colocar != "") send_reliable(peer_id, "dollarparacoins " + colocar, 0);
	} else if (m.get_item_name(mres) == "dlpointparacoins") {
		string colocar = v.input("how meny you'd like to be converted?");
		if (colocar != "") send_reliable(peer_id, "dlpointparadollar " + colocar, 0);
	}
}
void soundcardmenu(bool fromgame = false) {
	setupmenu(false);
	string[] d = sound_output_devices;
	for (uint i = 0; i < d.length(); i++) {
			m.add_item_tts(d[i], i);
	}
	m.add_item_tts("Go back", "back");
	int mres = m.run("Select output device.", true);
	if (mres == 0 or mres == -1 or m.get_item_name(mres) == "back") {
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		soundcard = string_to_number(m.get_item_name(mres));
		sound_output_device = soundcard;
		writeprefs();
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
string soundsmenu() {
	if (!directory_exists("upsounds")) {
		directory_create("upsounds");
		speak("No upsounds folder was found. It has now been created, you may put your files in it.");
		return "";
	}
	string[] soundfiles = find_files("upsounds/*.ogg");
	if (soundfiles.length() <= 0) {
		speak("No files found in upsounds");
		return "";
	}
	setupmenu(false, true);
	for (uint i = 0; i < soundfiles.length(); i++)
		m.add_item_tts(string_replace(soundfiles[i], ".ogg", "", true), soundfiles[i]);
	int mres = m.run("Choose a sound file to send", true);
	if (mres <= 0)
		return "";
	else return m.get_item_name(mres);
}
void chchangemenu() {
	setupmenu(false, true);
	m.add_item_tts("toggle pitch of chat sound", "chatsound");
	m.add_item_tts("toggle pitch of local chat sound", "localchatsound");
	m.add_item_tts("go back", "back");
	int mres = m.run("toggle pitch for chat and local chat", true);
}
void appsmenu() {
	setupmenu(false, true);
	m.add_item_tts("audio_box", "audiobox");
	m.add_item_tts("CDDrive_controller", "cd");
	m.add_item_tts("file uploader", "fileuploader");
	m.add_item_tts("mp3 file player", "mp3player");
	m.add_item_tts("OGG and WAV file player", "oggwavplayer");
	m.add_item_tts("smart player", "smartplayer");
	m.add_item_tts("voice recorder", "rec");
	m.add_item_tts("youtube downloader", "yd");
	m.add_item_tts("back", "back");
	int mres = m.run("select an option", true);
	if (m.get_item_name(mres) == "back" or mres == 0)
		return;
	else if (m.get_item_name(mres) == "audiobox")
		audioboxmenu();
	else if (m.get_item_name(mres) == "cd")
		cdmenu();
	else if (m.get_item_name(mres) == "oggwavplayer")
		fileloop();
	else if (m.get_item_name(mres) == "fileuploader")
		send_reliable(peer_id, "uploadsound", 0);
	else if (m.get_item_name(mres) == "mp3player")
		mp3loop();
	else if (m.get_item_name(mres) == "smartplayer")
		smartplayermenu();
	else if (m.get_item_name(mres) == "rec")
		recloop();
	else if (m.get_item_name(mres) == "yd") {
		string address = v.input("Paste youtube link");
		if (youtube_format != "") youtube_format = v.input("Enter the format that video should be converted on to. Type nothing to originally have the video", youtube_format);
		else youtube_format = v.input("Enter the format that video should be converted on to. Type nothing to originally have the video", "original format");
		bool result;
		if (address != "" and youtube_format != "") {
			if (ask("is this link a playlist?") == 1) {
				speak("downloading " + address + "");
				if (youtube_format == "original format")
					result = run("libraries/youtube-dl.exe", "--no-check-certificate --yes-playlist -o %(title)s.%(ext)s " + address + "", true, true);
				else if (youtube_format == "audio")
					result = run("libraries/youtube-dl.exe", "--no-check-certificate --extract-audio --yes-playlist -o %(title)s.%(ext)s " + address + "", true, true);
				else
					result = run("libraries/youtube-dl.exe", "-x --audio-format " + youtube_format + " --yes-playlist -o %(title)s.%(ext)s " + address + "", true, true);
			} else {
				speak("downloading " + address + "");
				if (youtube_format == "original format")
					result = run("libraries/youtube-dl.exe", "--no-check-certificate -o %(title)s.%(ext)s " + address + "", true, true);
				else if (youtube_format == "audio")
					result = run("libraries/youtube-dl.exe", "--no-check-certificate --extract-audio -o %(title)s.%(ext)s " + address + "", true, true);
				else
					result = run("libraries/youtube-dl.exe", "-x --audio-format " + youtube_format + " -o %(title)s.%(ext)s " + address + "", true, true);
			}
			speak("download completed, the file is located in the youtube media folder inside the aew directory");
			appsmenu();
		}
	}
}
void audioboxmenu() {
	setupmenu(false, true);
	m.add_item_tts("audio player", "audioplayer");
	m.add_item_tts("back", "back");
	int mres = m.run("Select an option", true);
	if (m.get_item_name(mres) == "audioplayer")
		audioplayer();
	else
		appsmenu();
}
void cdmenu() {
	string open, close;
	setupmenu(false, true);
	m.add_item_tts("open the cd drive", "cdopen");
	m.add_item_tts("close the cd drive", "cdclose");
	m.add_item_tts("back", "back");
	int mres = m.run("Select an option", true);
	if (m.get_item_name(mres) == "cdopen") {
		string open = mci_send_command("set cdaudio door open");
		if (open == "") speak("cd drive opened");
	} else if (m.get_item_name(mres) == "cdclose") {
		string close = mci_send_command("set cdaudio door closed");

		if (close == "") speak("cd drive closed");
	} else
		appsmenu();
}
void fileloop() {
	string pfile = v.input("enter the name of the file that should be played with its extention. For example, test.ogg. Supported files: OGG, WAV");
	if (!file_exists("smart player audio files/" + pfile)) {
		MessageBox("error", "" + pfile + " does not exists on smart player audio files folder");
		appsmenu();
	} else {
		ffile.load("smart player audio files/" + pfile);
		ffile.play_looped();
		while (true) {
			wait(5);
			mainloop();
			if (key_pressed(KEY_LEFT))
				ffile.seek(0);
			if (key_pressed(KEY_SPACE)) {
				if (ffile.playing == true)
					ffile.pause();
				else
					ffile.play();
			}
			if (key_pressed(KEY_UP) and get_sound_master_volume() < 0) {
				set_sound_master_volume(get_sound_master_volume() + 1);
				speak(get_sound_master_volume());
			}
			if (key_pressed(KEY_DOWN) and get_sound_master_volume() > -60) {
				set_sound_master_volume(get_sound_master_volume() - 1);
				speak(get_sound_master_volume());
			}
			if (key_pressed(KEY_ESCAPE)) {
				ffile.stop();
				appsmenu();
				break;
			}
		}
	}
}
void mp3loop() {
	string mp3 = v.input("enter the name of file that should be played with its extention. For example, test.mp3. Supported files: MP3");
	if (!file_exists("smart player audio files/" + mp3)) {
		MessageBox("error", "" + mp3 + " does not exists on smart player audio files folder");
		appsmenu();
	} else {
		load("smart player audio files/" + mp3);
		play();
		while (true) {
			wait(5);
			mainloop();
			if (key_pressed(KEY_ESCAPE)) {
				stop();

				appsmenu();
				break;
			}
			if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT)) {
				if (key_pressed(KEY_COMMA) == false and kcomma.pressing())
					prevbufferitem();
				if (key_pressed(KEY_PERIOD) == false and kperiod.pressing())
					nextbufferitem();
				if (key_pressed(KEY_LBRACKET) == false and klbracket.pressing())
					bufferleft();
				if (key_pressed(KEY_RBRACKET) == false and krbracket.pressing())
					bufferright();
			}
			if (shift_is_down()) {
				if (key_pressed(KEY_COMMA))
					topbufferitem();
				if (key_pressed(KEY_PERIOD))
					bottombufferitem();
				if (key_pressed(KEY_LBRACKET))
					firstbuffer();
				if (key_pressed(KEY_RBRACKET))
					lastbuffer();
			}
			if (key_pressed(KEY_SLASH)) {
				string chat = v.input("type your message here");
				if (chat != "" and !is_eloquence_crash_word(chat) and get_sequence(chat, true) <= 3) {
					string[] chats = string_split(chat, "::", true);
					if (chat != "") {
						string sendmsg = chat;
						for (uint a = 0; a < aliases.length(); a += 1) {
							string[] a2 = string_split(aliases[a], ":", false);
							if (a2.length() == 2)
								sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
						}
						send_reliable(peer_id, sendmsg, 1);
					}
				}
			}
			if (key_pressed(KEY_BACKSLASH) and dlocalchat == 0) {
				string s = v.input("type your message here");
				if (s != "" and !is_eloquence_crash_word(s) and get_sequence(s, true) <= 3) {
					string sendmsg = s;
					for (uint a = 0; a < aliases.length(); a += 1) {
						string[] a2 = string_split(aliases[a], ":", false);
						if (a2.length() == 2)
							sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
					}
					send_reliable(peer_id, "localchat " + sendmsg, 0);
				}
			}
			if (key_up(KEY_LSHIFT) and key_up(KEY_RSHIFT) and key_up(KEY_LMENU) and key_up(KEY_RMENU) and key_pressed(KEY_EQUALS)) {
				string colocar = v.input("enter the command. Note: / will be put before it automaticly");
				if (colocar != "" and !is_eloquence_crash_word(colocar) and get_sequence(colocar, true) <= 3) {
					string sendmsg = colocar;
					for (uint a = 0; a < aliases.length(); a += 1) {
						string[] a2 = string_split(aliases[a], ":", false);
						if (a2.length() == 2)
							sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
					}
					send_reliable(peer_id, "/" + sendmsg, 1);
				}
			}
			if (key_pressed(KEY_UP) and get_sound_master_volume() < 0) {
				set_sound_master_volume(get_sound_master_volume() + 1);
				speak(get_sound_master_volume());
			}
			if (key_pressed(KEY_DOWN) and get_sound_master_volume() > -60) {
				set_sound_master_volume(get_sound_master_volume() - 1);
				speak(get_sound_master_volume());
			}
		}
	}
}
void recloop() {
	dlg("press enter to skip this message. Press r to start/stop recording. The file will be in the smart phone audio files in the game directory");
	while (true) {
		wait(5);
		mainloop();
		if (key_pressed(KEY_R) and spamtimer.elapsed >= spamtime) {
			if (recording == false) {
				spamtimer.restart();
				vc.record();
				p.play_stationary("von.ogg", false);
				recording = true;
				rectimer.restart();
			} else if (recording == true) {
				p.play_stationary("voff.ogg", false);
				vc.stop(true, DIRECTORY_TEMP + "\\convert.ogg", true);
				file f;
				f.open(DIRECTORY_TEMP + "\\convert.ogg", "rb");
				f.close();
				file_delete(DIRECTORY_TEMP + "\\convert.ogg");
				recording = false;
				spamtimer.restart();
			}
		}
		if (key_pressed(KEY_ESCAPE))
			return;
	}
}
void smartplayermenu() {
	setupmenu(false, true);
	m.add_item_tts("directly Listen to a file from your computer", "computer");
	m.add_item_tts("directly listen to a file by a link", "link");
	m.add_item_tts("back", "back");
	int mres = m.run("Select an option", true);
	if (m.get_item_name(mres) == "computer")
		driveloop();
	else if (m.get_item_name(mres) == "link")
		linkloop();
	else
		appsmenu();
}
void msgmenu() {
	setupmenu(false, true);
	m.add_item_tts("send a public message", "sendpublicmsg");
	m.add_item_tts("send a private message", "sendprivatemsg");
	m.add_item_tts("reply to the last message", "reply");
	m.add_item_tts("send a local chat", "sendlocalchat");
	m.add_item_tts("back", "back");
	int mres = m.run("select an option", true);
	if (m.get_item_name(mres) == "back" or mres == 0)
		return;
	else if (m.get_item_name(mres) == "sendpublicmsg") {
		string chat = pv.input("enter chat");
		if (chat != "" and !is_eloquence_crash_word(chat) and get_sequence(chat, true) <= 3) {
			string[] chats = string_split(chat, "::", true);
			if (chat != "") {
				string sendmsg = chat;
				for (uint a = 0; a < aliases.length(); a += 1) {
					string[] a2 = string_split(aliases[a], ":", false);
					if (a2.length() == 2)
						sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
					send_reliable(peer_id, sendmsg, 1);
				}
			}
		}
	} else if (m.get_item_name(mres) == "sendprivatemsg") {
		string pn = pv.input("player name");
		if (pn != "" and !is_eloquence_crash_word(pn) and get_sequence(pn, true) <= 3) {
			string msg = pv.input("message");
			if (msg != "" and !is_eloquence_crash_word(msg) and get_sequence(msg, true) <= 3)
				send_reliable(peer_id, "/pm " + pn + " " + msg, 1);
		}
	} else if (m.get_item_name(mres) == "reply") {
		string msg = pv.input("message");
		if (msg != "" and !is_eloquence_crash_word(msg) and get_sequence(msg, true) <= 3)
			send_reliable(peer_id, "/r " + msg, 1);
	} else if (m.get_item_name(mres) == "sendlocalchat") {
		string s = pv.input("enter your message");
		if (s != "" and !is_eloquence_crash_word(s) and get_sequence(s, true) <= 3) {
			if (s != "") {
				string sendmsg = s;
				for (uint a = 0; a < aliases.length(); a += 1) {
					string[] a2 = string_split(aliases[a], ":", false);
					if (a2.length() == 2)
						sendmsg = string_replace(sendmsg, a2[0], a2[1], true);
					send_reliable(peer_id, "localchat " + sendmsg, 0);
				}
			}
		}
	}
}
void defjoymenu(bool fromgame = false) {
	setupmenu(false);
	j.refresh_joystick_list();
	const string[] js = j.list_joysticks();
	if (j.joysticks < 1)
		m.add_item_tts("No joysticks/game pads currently connected. Press enter to rescan.", "no");
	else {
		for (uint8 i = 0; i < js.length(); i++) {
			j.set(i);
			if (defjoy == i)
				m.add_item_tts("Currently active, " + js[i] + ". " + joyinfo(i), "" + i);
			else
				m.add_item_tts(js[i] + ". " + joyinfo(i), "" + i);
		}
	}
	m.add_item_tts("Go back", "back");
	j.set(defjoy);
	int mres = -1;
	if (j.joysticks > 0)
		mres = m.run("" + j.joysticks + " joysticks/gamepads are currently connected. Select your preferred one.", true);
	else
		mres = m.run("No joysticks/gamepads are currently connected. Connect your joystick/gamepad and then click on the first menu item to rescan.", true);
	if (mres == 0 or mres == -1 or m.get_item_name(mres) == "back") {
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else if (m.get_item_name(mres) == "no")
		defjoymenu();
	else if (mres - 1 == defjoy) {
		speak("Keeping " + js[defjoy]);
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		defjoy = string_to_number(m.get_item_name(mres));
		defjoyname = js[defjoy];
		writeprefs();
		speak("Ok. " + js[defjoy] + " is now your default joystick/game pad.");
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
string joyinfo(small joy) {
	const bool[] h1 = {j.has_x, j.has_y, j.has_z, j.has_r_x, j.has_r_y, j.has_r_z};
	const string[] d1 = {"X axis", "Y axis", "Z axis", "rotational X axis", "rotational Y axis", "rotational Z axis"};
	const int[] h2 = {j.buttons, j.sliders, j.povs};
	const string[] d2 = {"buttons", "sliders", "point of view controls"};
	string o = "";

	for (uint i = 0; i < h1.length(); i++) {
		if (h1[i])
			o += ", " + d1[i];
	}
	for (uint i = 0; i < h2.length(); i++) {
		if (h2[i] > 0)
			o += ", " + h2[i] + " " + d2[i];
	}
	o = string_trim_left(o, 2);
	return o;
}
void checkarroundmenu() {
	menuitem@[] cs(0);
	cs.insert_last(menuitem("Stop tracking", "stoptrack"));
	foreach (zone@ l: zones) {
		if (!l.trackable) continue;
		if (dcoordinates == 0) cs.insert_last(menuitem(l.text + " at " + l.minx + ", " + l.miny + ", " + l.minz, l.id));
		else cs.insert_last(menuitem(l.text, l.id));
	}
	string mres = menu("Find what?", cs);
	if (mres == "" or mres == "stoptrack") {
		speak("Stopped tracking");
		trackx = -1; tracky = -1; trackz = -1; tracking = "";
		return;
	} else {
		int zz = get_zone_index(mres);
		if (zz > -1) {
			zone@ z = zones[zz];
			trackx = z.minx;
			tracky = z.miny;
			trackz = z.minz;
			tracking = z.text;
			tell_where(trackx, tracky, trackz, "loctrack", false);
		} else {
			if (SCRIPT_COMPILED == false) speak("That zone could not be found");
		}
	}
}
void checkarroundtilesmenu() {
	setupmenu(false, true);
	m.add_item_tts("Stop tracking", "stoptrack");
	foreach (tile@ l: tiles) {
		if (!l.trackable) continue;
		string t = gettile(l.type);
		if (t == "") t = "air";
		if (dcoordinates == 0) m.add_item_tts(t + " at " + l.minx + ", " + l.miny + ", " + l.minz, l.id);
		else m.add_item_tts(t, l.id);
	}
	m.set_callback(netclb, "");
	int mres = m.run("Find what?", true);
	if (m.get_item_name(mres) == "" or m.get_item_name(mres) == "stoptrack" or mres == 0) {
		speak("Stopped tracking");
		ttrackx = -1; ttracky = -1; ttrackz = -1; ttracking = "";
		return;
	} else {
		int t = get_tile_index(m.get_item_name(mres));
		if (t > -1) {
			tile@ tt = @tiles[t];
			ttrackx = tt.minx;
			ttracky = tt.miny;
			ttrackz = tt.minz;
			ttracking = tt.type;
			tell_where(ttrackx, ttracky, ttrackz, "loctrack", false);
		} else {
			if (SCRIPT_COMPILED == false) speak("That tile could not be found");
		}
	}
}
void spellmenu(string data) {
	string[] spells = string_split(data, "\r\n", false);
	setupmenu(false, true);
	for (uint i = 0; i < spells.length(); i++) {
		string[] parsed = string_split(spells[i], ":", false);
		m.add_item_tts(spells[i], parsed[0]);
	}
	m.set_callback(netclb, "");
	int mres = m.run("Choose a spell to cast", true);
	if (mres == 0) return;
	else {
		string spell = m.get_item_name(mres);
		send_reliable(peer_id, "spellcast " + spell, 0);
	}
}
string daritem() {
	if (ausente || !can_move)return "";
	menusilent();
	for (int i = me.x - 3; i <= me.x + 3; i++) {
		for (uint i2 = 0; i2 < players.length(); i2++) {
			if (players[i2].x == i && players[i2].y == i && players[i2].name != name && players[i2].map == mapname && players[i2].z == me.z)
				m.add_item_tts(players[i2].name, players[i2].name);
		}
	}
	m.set_callback(netclb, "");
	int mres = m.run("Select the player you want", true);
	if (mres <= 0) {
		speak("No one around.");
		return"";
	} else return m.get_item_name(mres);
}
void serverlistmenu() {
	setupmenu(false, true);
	string data = url_get("http://balls.com/dl/dlsvr.txt");
	string[] servers = string_split(data, "\r\n", false);
	if (servers.length() == 1 and servers[0] == "") {
		dlg("No servers.");
		mainmenu();
	} else if (servers.length() > 0) {
		for (uint i = 0; i < servers.length(); i++) {
			string[] server = string_split(servers[i], "::", true);
			if (server.length() >= 3)
				m.add_item_tts(server[0], server[1] + "::" + server[2]);
		}
	}
	m.set_callback(netclb, "");
	int mres = m.run("Server list", true);
	string a = m.get_item_name(mres);
	if (a != "") {
		string[] server = string_split(a, "::", true);
		netaddress = server[0];
		netport = string_to_number(server[1]);
		writeprefs();
		mainmenu();
	} else
		mainmenu();
}
void serverlistmenu2() {
	setupmenu(false, true);
	string data = url_get("http://balls.com/dl/dlsvr.txt");
	string[] servers = string_split(data, "\r\n", false);
	if (servers.length() == 1 and servers[0] == "") {
		dlg("No servers.");
		mainmenu();
	} else if (servers.length() > 0) {
		for (uint i = 0; i < servers.length(); i++) {
			string[] server = string_split(servers[i], "::", true);
			if (server.length() >= 3)
				m.add_item_tts(server[0], server[1] + "::" + server[2]);
		}
	}
	m.set_callback(netclb, "");
	int mres = m.run("Server list", true);
	string a = m.get_item_name(mres);
	if (a != "") {
		string[] server = string_split(a, "::", true);
		netaddress = server[0];
		netport = string_to_number(server[1]);
		writeprefs();
		mainmenu();
	} else
		mainmenu();
}
string select_player(string text, string data) {
	setupmenu(false, true);
	string[] parsed = string_split(data, "\r\n", true);
	for (uint i = 0; i < parsed.length(); i++)
		m.add_item_tts(parsed[i], parsed[i]);
	m.add_item_tts("Go back", "back");
	m.set_callback(netclb, "");
	int mres = m.run(text, true);
	if (m.get_item_name(mres) == "back" or mres == 0)
		return "";
	else
		return m.get_item_name(mres);
}
void mnormal(string mensagem) {
	mensagem.replace_this("\r\n", "\n");
	setupmenu(false, true);
	string[] mmensagem = string_split(mensagem, "\n");
	string[] bla = string_split(mmensagem[0], ":");
	for (uint i = 1; i < mmensagem.length(); i++) {
		string[] z = string_split(mmensagem[i], ":", false);
		m.add_item_tts(z[0], z[1]);
	}
	m.add_item_tts("Go back", "0");
	m.set_callback(netclb, "");
	int mres = m.run(bla[0], true);
	if (m.get_item_name(mres) != "0")
		send_reliable(peer_id, bla[1] + " " + m.get_item_name(mres), 0);
}
void mnormal2(string mensagem) {
	mensagem.replace_this("\r\n", "\n");
	setupmenu(false, true);
	string[] mmensagem = string_split(mensagem, "\n");
	string[] bla = string_split(mmensagem[0], bell2);
	for (uint i = 1; i < mmensagem.length(); i++) {
		string[] z = string_split(mmensagem[i], bell2, false);
		if (z.length() > 1)m.add_item_tts(z[0], z[1]);
	}
	m.add_item_tts("go back", "0");
	m.set_callback(netclb, "");
	int mres = m.run(bla[0], true);
	if (m.get_item_name(mres) != "0")
		send_reliable(peer_id, bla[1] + " " + m.get_item_name(mres), 0);
}
void mtext(string mensagem) {
	string[] mmensagem = string_split(mensagem, "\r\n", true);
	string[] bla = string_split(mmensagem[0], ":", false);
	string z = v.input(bla[0]);
	if (z != "" and !is_eloquence_crash_word(z) and get_sequence(z, true) <= 3)
		send_reliable(peer_id, bla[1] + " " + z, 0);
}
string telemenu() {
	if (!can_move)return "";
	menusilent();
	m.add_item_tts("main city", "main");
	m.add_item_tts("go back", "back");
	m.set_callback(netclb, "");
	int mres = m.run("Choose the map you want to teleport to", true);
	if (mres <= 0)
		return"";
	else return m.get_item_name(mres);
}
void mtester(string maps) {
	setupmenu(false, true);
	string[] mmaps = string_split(maps, "\n");
	for (uint i = 0; i < mmaps.length(); i++)
		m.add_item_tts(string_replace(mmaps[i], ".map", "", true), string_replace(mmaps[i], ".map", "", true));
	m.add_item_tts("go back", "back");
	m.set_callback(netclb, "");
	int mres = m.run("Choose the map you want to go to", true);
	if (m.get_item_name(mres) != "0")
		send_reliable(peer_id, "mtester " + m.get_item_name(mres), 0);
}
void mtester3(string maps) {
	setupmenu(false, true);
	string[] mmaps = string_split(maps, "\n");
	for (uint i = 0; i < mmaps.length(); i++)
		m.add_item_tts(string_replace(mmaps[i], ".map", "", true), string_replace(mmaps[i], ".map", "", true));
	m.add_item_tts("go back", "back");
	m.set_callback(netclb, "");
	int mres = m.run("Choose the map you want to teleport to", true);
	if (m.get_item_name(mres) != "0")
		send_reliable(peer_id, "mtester3 " + m.get_item_name(mres), 0);
}
void tlptester(string maps) {
	setupmenu(false, true);
	maps.replace_this("\r\n", "\n");
	string[] mmaps = string_split(maps, "\n");
	for (uint i = 0; i < mmaps.length(); i++)
		m.add_item_tts(string_replace(mmaps[i], ".map", "", true), string_replace(mmaps[i], ".map", "", true));
	m.add_item_tts("go back", "back");
	m.set_callback(netclb, "");
	int mres = m.run("Choose the map you want to teleport to", true);
	if (m.get_item_name(mres) != "0")
		send_reliable(peer_id, "tlptester " + m.get_item_name(mres), 0);
}
void removealiasmenu(bool fromgame = false) {
	setupmenu(false, true);
	if (aliases.length() < 1) {
		speak("no aliases available");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		for (uint i = 0; i < aliases.length(); i++) {
			string[] a2 = string_split(aliases[i], ":", false);
			m.add_item_tts("text: " + a2[0] + ", replacement: " + a2[1] + "", aliases[i]);
		}
	}
	m.add_item_tts("go back", "back");
	int mres = m.run("Select the line that should be removed", true);
	if (m.get_item_name(mres) == "back" or mres == 0) {
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		int something = aliases.find(m.get_item_name(mres));
		if (something > -1)
			aliases.remove_at(something);
		speak("done");
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void removescript_keymenu(bool fromgame = false) {
	setupmenu(false, true);
	if (script_keys.length() < 1) {
		speak("no script keys available");
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		for (uint i = 0; i < script_keys.length(); i++) {
			string[] a2 = string_split(script_keys[i], ":");
			if (a2.length() < 1) continue;
			string key = a2[0];
			string act = (a2.length() > 1 ? a2[1] : "none");
			m.add_item_tts("key: " + key + ", action: " + act, script_keys[i]);
		}
	}
	m.add_item_tts("go back", "back");
	m.ingame = connected;
	int mres = m.run("Select the line that should be removed", true);
	if (m.get_item_name(mres) == "back" or mres == 0) {
		if (fromgame) mainmenu(true);
		else mainmenu();
	} else {
		int something = script_keys.find(m.get_item_name(mres));
		if (something > -1)
			script_keys.remove_at(something);
		speak("done");
		if (fromgame) mainmenu(true);
		else mainmenu();
	}
}
void get_voice_menu() {
	setupmenu(false);
	ttsv.refresh();
	string[] j = ttsv.get_voice_names();
	if (j.length() > 0) {
		for (uint i = 0; i < j.length(); i += 1)
			m.add_item_tts(j[i], "" + i);
	}
	m.set_callback(netclb, "");
	int mres = m.run("Select voice", true);
	voiceindex = mres - 1;
	bool set = ttsv.set_current_voice(voiceindex);
	speak((set == true ? "ok" : "Could not set voice"));
}
void dbmenu() {
	string address = v.input("Paste the link");
	if (youtube_format != "") youtube_format = v.input("Enter the format that video should be converted on to. Type nothing to have the video on the format that you've previously typed", youtube_format);
	else youtube_format = v.input("Enter the format that video should be converted on to. Type nothing to originally have the video", "original format");
	bool result;
	if (address != "" and youtube_format != "") {
		string path = string_trim_right(get_script_path(), 8);
		if (ask("is this link a playlist?") == 1) {
			speak("downloading " + address + "");
			if (youtube_format == "original format")
				result = run("libraries/youtube-dl.exe", "--no-check-certificate --yes-playlist -o %(title)s.%(ext)s " + address + "", true, true);
			else if (youtube_format == "audio")
				result = run("libraries/youtube-dl.exe", "--no-check-certificate --extract-audio --yes-playlist -o %(title)s.%(ext)s " + address + "", true, true);
			else
				result = run("libraries/youtube-dl.exe", "-x --audio-format " + youtube_format + " --yes-playlist -o %(title)s.%(ext)s " + address + "", true, true);
		} else {
			speak("downloading " + address + "");
			if (youtube_format == "original format")
				result = run("libraries/youtube-dl.exe", "--no-check-certificate -o %(title)s.%(ext)s " + address + "", true, true);
			else if (youtube_format == "audio")
				result = run("libraries/youtube-dl.exe", "--no-check-certificate --extract-audio -o %(title)s.%(ext)s " + address + "", true, true);
			else
				result = run("libraries/youtube-dl.exe", "-x --audio-format " + youtube_format + " -o %(title)s.%(ext)s " + address + "", true, true);
		}
		speak("download completed, the file is located in the aew directory");
		return;
	}
}
int ask(string quest, string yes = "Yes", string no = "No", bool say_dialog = false) {
	//1=yes, 2=no and -1 on failure
	if (quest.empty() || yes.empty() || no.empty()) return -1;
	custom_menu c;
	setupmenu(c);
	c.add(yes, yes);
	c.add(no, no);
	c.create(quest, say_dialog);
	string r;
	while (c.running) {
		wait(5);
		c.monitor();
		mainloop();
		r = c.click;
		if (r != "") break;
	}//While
	if (r == yes) return 1;
	else if (r == no) return 2;
	else return -1;
}//
void buffermenu() {
	buffer@ b = current_buffer;
	if (@b == null) return;
	string msg = "%0 %1";
	menuitem@[] cs(0);
	cs.insert_last(menuitem(msg.format((b.muted ? "Unmute" : "Mute") + " the buffer", b.name), "mute"));
	cs.insert_last(menuitem(msg.format((b.active == 1 ? "Deactivate" : "Activate") + " the buffer", b.name), "active"));
	string t = menu("Buffer menu", cs);
	if (t == "") return;
	else if (t == "mute" && @b != null) {
		b.muted = toggle(b.muted);
		speak("Buffer " + b.name + " " + (b.muted ? "muted" : "unmuted"));
		return;
	} else if (t == "active") {
		b.active = toggle(b.active);
		speak((b.active == 1 ? "Buffer activated" : "Buffer deactivated"));
		return;
	}
}

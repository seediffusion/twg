class learn_game_sounds {
	private form_menu@ ms;
	private dictionary@ sfx;
	private array<string>@ sfx_names;
	private string audio_prefix;
	private sound audio;
	private string select_sound;
	learn_game_sounds(dictionary@ sfx_dict, const string&in prefix = "", form_menu@ existing_menu = null) {
		@sfx = sfx_dict;
		audio_prefix = prefix;
		form_menu temp_menu;
		if (existing_menu is null)
			@ms = @temp_menu;
		else
			@ms = existing_menu;
				ms.reset(true);
		if (ms.intro_text.empty())
			ms.intro_text="Select a sound with up and down arrow keys, press enter to hear it. Press escape or select the Go back option to exit this menu.";
		select_sound=ms.select_sound;
		ms.select_sound="";
		@sfx_names=sfx.get_keys();
		sfx_names.sort_ascending();
		ms.add_items(sfx_names);
		ms.add_item("Go back");
		ms.wrap=false;
		ms.focus_first_item=true;
		ms.automatic_intro=false;
	}
	void run() {
		ms.intro();
		while(true) {
			wait(5);
			int old_pos=ms.focused_item;
			bool keep_running=ms.monitor();
			if(ms.focused_item != old_pos) {
				audio.close();
			}
			if(keep_running) continue;
			if(ms.selected_item < 0) {
if (audio.playing) audio.close();
			mainmenu();;
			}
			if(ms.selected_item >= int(sfx_names.length())) {
			if (audio.playing) audio.close();
				ms.play(select_sound);
				mainmenu();
			}
			string filename;
			if(!sfx.get(sfx_names[ms.selected_item], filename)) {
				auto@ val=sfx[sfx_names[ms.selected_item]];
				array<string>@ filenames=cast<array<string>@>(val);
				if(filenames !is null&&filenames.length() > 0)
					filename=filenames[random(0, filenames.length() - 1)];
			}
			if(!filename.empty()) {
				audio.load(audio_prefix + filename+".ogg");
				if(audio.active==false) {
				speak("Error. Unable to load this sound file.");
				continue;
				}
				audio.pitch=0;
				audio.pan=0;
				audio.volume=0;
				audio.play();
			}
		}	
	}
}